# ä¿¡æ¯çŠ¶æ€ (Information State) è¯¦è§£

## ğŸ“‹ ä¿¡æ¯çŠ¶æ€æ˜¯å¦å¯ä»¥è‡ªå®šä¹‰ï¼Ÿ

**ç­”æ¡ˆï¼šä¸èƒ½ç›´æ¥åœ¨ Python ä¸­è‡ªå®šä¹‰**

ä¿¡æ¯çŠ¶æ€çš„æ ¼å¼æ˜¯åœ¨ C++ å±‚é¢ï¼ˆ`universal_poker.cc`ï¼‰å®šä¹‰çš„ï¼Œæ ¼å¼æ˜¯å›ºå®šçš„ã€‚å¦‚æœéœ€è¦è‡ªå®šä¹‰ï¼Œéœ€è¦ï¼š
1. ä¿®æ”¹ C++ æºä»£ç 
2. é‡æ–°ç¼–è¯‘ OpenSpiel

## ğŸ“Š ä¿¡æ¯çŠ¶æ€ç»“æ„ï¼ˆ6äººåœºï¼Œ266ç»´ï¼‰

### å®Œæ•´ç»“æ„

```
æ€»å¤§å° = 6 + 52 + 52 + (max_game_length * 2) + max_game_length
       = 6 + 52 + 52 + (78 * 2) + 78
       = 266
```

### å„éƒ¨åˆ†è¯¦è§£

#### 1. ç©å®¶ä½ç½® (6 bits)
- **ä½ç½®**: bits 0-5
- **æ ¼å¼**: One-hot ç¼–ç 
- **ç¤ºä¾‹**: `[0, 0, 1, 0, 0, 0]` è¡¨ç¤ºç©å®¶2

#### 2. æ‰‹ç‰Œ (52 bits)
- **ä½ç½®**: bits 6-57
- **æ ¼å¼**: æ¯å¼ ç‰Œä¸€ä¸ªbitï¼Œ1è¡¨ç¤ºæœ‰è¿™å¼ ç‰Œ
- **ç¼–ç **: 
  - ç‰Œç´¢å¼• = rank * 4 + suit
  - rank: 0-12 (2, 3, ..., K, A)
  - suit: 0-3 (s, h, d, c)
- **ç¤ºä¾‹**: 
  - `As` = 12*4 + 0 = 48
  - `Kh` = 11*4 + 1 = 45

#### 3. å…¬å…±ç‰Œ (52 bits)
- **ä½ç½®**: bits 58-109
- **æ ¼å¼**: æ¯å¼ ç‰Œä¸€ä¸ªbitï¼Œ1è¡¨ç¤ºæ˜¯å…¬å…±ç‰Œ
- **ç¼–ç **: ä¸æ‰‹ç‰Œç›¸åŒ

#### 4. åŠ¨ä½œåºåˆ— (max_game_length * 2 bits = 156 bits)
- **ä½ç½®**: bits 110-265
- **æ ¼å¼**: æ¯2ä¸ªbitè¡¨ç¤ºä¸€ä¸ªåŠ¨ä½œ
- **ç¼–ç **:
  - `'f'` (fold) = `00`
  - `'c'` (call) = `10`
  - `'p'` (raise) = `01`
  - `'a'` (all-in) = `11`
  - `'d'` (deal) = `00`

#### 5. åŠ¨ä½œå¤§å° (max_game_length integers = 78)
- **ä½ç½®**: bits 188-265 (ä¸åŠ¨ä½œåºåˆ—é‡å ï¼Œå®é™…æ˜¯åˆ†å¼€å­˜å‚¨)
- **æ ¼å¼**: æ¯ä¸ªåŠ¨ä½œçš„ä¸‹æ³¨é‡‘é¢
- **è¯´æ˜**: 0è¡¨ç¤ºæœªä¸‹æ³¨æˆ–å·²è¿‡ç‰Œ

## ğŸ” å¦‚ä½•æŸ¥çœ‹ä¿¡æ¯çŠ¶æ€

### æ–¹æ³•1: ä½¿ç”¨æ‰“å°è„šæœ¬

```bash
conda activate open_spiel
python print_info_state.py --num_players 6 --num_steps 20
```

### æ–¹æ³•2: åœ¨ä»£ç ä¸­ç›´æ¥è®¿é—®

```python
import numpy as np
import pyspiel

# åˆ›å»ºæ¸¸æˆ
game = pyspiel.load_game("universal_poker(...)")
state = game.new_initial_state()

# è·å–ä¿¡æ¯çŠ¶æ€
info_state = np.array(state.information_state_tensor(0))
print(f"ä¿¡æ¯çŠ¶æ€å¤§å°: {len(info_state)}")
print(f"ç©å®¶ä½ç½®: {info_state[0:6]}")
print(f"æ‰‹ç‰Œ bits: {info_state[6:58]}")
print(f"å…¬å…±ç‰Œ bits: {info_state[58:110]}")
```

## ğŸ“ ä¿¡æ¯çŠ¶æ€ç¤ºä¾‹

### Preflop é˜¶æ®µï¼ˆç©å®¶2ï¼‰

```
ä¿¡æ¯çŠ¶æ€å‘é‡å¤§å°: 266
éé›¶å…ƒç´ : 3

[1] ç©å®¶ä½ç½®: [0, 0, 1, 0, 0, 0]  # ç©å®¶2
[2] æ‰‹ç‰Œ: [7s, 9h]  # 2ä¸ªbitä¸º1
[3] å…¬å…±ç‰Œ: []  # å…¨ä¸º0
[4] åŠ¨ä½œåºåˆ—: []  # å…¨ä¸º0ï¼ˆè¿˜æœªæœ‰åŠ¨ä½œï¼‰
[5] åŠ¨ä½œå¤§å°: []  # å…¨ä¸º0
```

### Flop é˜¶æ®µï¼ˆç©å®¶0ï¼‰

```
ä¿¡æ¯çŠ¶æ€å‘é‡å¤§å°: 266
éé›¶å…ƒç´ : 8

[1] ç©å®¶ä½ç½®: [1, 0, 0, 0, 0, 0]  # ç©å®¶0
[2] æ‰‹ç‰Œ: [As, Kh]  # 2ä¸ªbitä¸º1
[3] å…¬å…±ç‰Œ: [Kd, Qc, 7s]  # 3ä¸ªbitä¸º1
[4] åŠ¨ä½œåºåˆ—: 
  ä½ç½® 0: Call (bits: [1, 0])
  ä½ç½® 1: Call (bits: [1, 0])
  ...
[5] åŠ¨ä½œå¤§å°:
  ä½ç½® 0: 100  # ç›²æ³¨
  ä½ç½® 1: 100  # ç›²æ³¨
  ...
```

## âš ï¸ é‡è¦è¯´æ˜

1. **æ ¼å¼å›ºå®š**: ä¿¡æ¯çŠ¶æ€çš„æ ¼å¼ç”± OpenSpiel çš„ C++ ä»£ç å†³å®šï¼Œä¸èƒ½ç›´æ¥åœ¨ Python ä¸­ä¿®æ”¹

2. **è‡ªå®šä¹‰æ–¹æ³•**:
   - ä¿®æ”¹ `open_spiel/games/universal_poker/universal_poker.cc` ä¸­çš„ `InformationStateTensor` æ–¹æ³•
   - é‡æ–°ç¼–è¯‘ OpenSpiel
   - æˆ–è€…ä½¿ç”¨ Observer æ¨¡å¼åˆ›å»ºè‡ªå®šä¹‰è§‚å¯Ÿè¡¨ç¤º

3. **ä½¿ç”¨å»ºè®®**:
   - å¦‚æœåªæ˜¯éœ€è¦ä¸åŒçš„ç‰¹å¾è¡¨ç¤ºï¼Œå¯ä»¥åœ¨ç½‘ç»œè¾“å…¥å±‚ä¹‹å‰æ·»åŠ ä¸€ä¸ªè½¬æ¢å±‚
   - æˆ–è€…ä½¿ç”¨ Observation Tensorï¼ˆæ ¼å¼æ›´ç®€å•ï¼Œä½†ä¿¡æ¯æ›´å°‘ï¼‰

## ğŸ”— ç›¸å…³ä»£ç ä½ç½®

- **C++ å®ç°**: `open_spiel/games/universal_poker/universal_poker.cc:408-496`
- **Python ä½¿ç”¨**: `open_spiel/python/pytorch/deep_cfr.py:420-424`
- **æ‰“å°è„šæœ¬**: `print_info_state.py`

## ğŸ“š å‚è€ƒèµ„æ–™

- OpenSpiel æ–‡æ¡£: https://github.com/deepmind/open_spiel
- Universal Poker å®ç°: `open_spiel/games/universal_poker/`


